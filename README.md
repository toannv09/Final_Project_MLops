<p align="center">
  <a href="https://www.uit.edu.vn/" title="TrÆ°á»ng Äáº¡i há»c CÃ´ng nghá»‡ ThÃ´ng tin" style="border: 5;">
    <img src="https://i.imgur.com/WmMnSRt.png" alt="TrÆ°á»ng Äáº¡i há»c CÃ´ng nghá»‡ ThÃ´ng tin | University of Information Technology">
  </a>
</p>

<!-- Title -->
<h1 align="center"><b>CS317.P21 - PHÃT TRIá»‚N VÃ€ Váº¬N HÃ€NH Há»† THá»NG MÃY Há»ŒC</b></h1>

## Äá»’ ÃN: VIETNAMESE FOOD CLASSIFICATION 

## GIá»šI THIá»†U MÃ”N Há»ŒC
<a name="gioithieumonhoc"></a>
* *TÃªn mÃ´n há»c*: PhÃ¡t triá»ƒn vÃ  váº­n hÃ nh há»‡ thá»‘ng mÃ¡y há»c
* *MÃ£ mÃ´n há»c*: CS317.P21
* *NgÃ y báº¯t Ä‘áº§u*: 17/02/2025
* *NÄƒm há»c*: 2024-2025

## GIáº¢NG VIÃŠN HÆ¯á»šNG DáºªN
<a name="giangvien"></a>
* *Äá»— VÄƒn Tiáº¿n* - tiendv@uit.edu.vn
* *LÃª Tráº§n Trá»ng KhiÃªm* - khiemltt@uit.edu.vn

## THÃ€NH VIÃŠN NHÃ“M
<a name="thanhvien"></a>
* Nguyá»…n Váº¹n ToÃ n - 22521492
* ÄÃ o VÄƒn TuÃ¢n - 22521599
* VÅ© Anh Tuáº¥n - 22521614

## PIPIELINE
![image](https://github.com/user-attachments/assets/12a25bdf-02d7-44fc-886c-84bb236269e0)

## HÆ¯á»šNG DáºªN TRACKING
Táº£i file vnfood-tracking.ipynb. Sau Ä‘Ã³ upload lÃªn kaggle Ä‘á»ƒ sá»­ dá»¥ng. Dataset nhÃ³m sá»­ dá»¥ng lÃ  30VNFoods cÅ©ng cÃ³ trÃªn Kaggle.<br>
CÃ´ng cá»¥ tracking Ä‘Æ°á»£c nhÃ³m lá»±a chá»n sá»­ dá»¥ng lÃ  Weight & Biases (Wandb). DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c bÆ°á»›c thá»±c hiá»‡n cho quÃ¡ trÃ¬nh tracking:<br><br>
a.	ÄÄƒng nháº­p<br>
Äá»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng Wandb cho má»¥c Ä‘Ã­ch track láº¡i dá»¯ liá»‡u trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n, ta cáº§n tÃ­ch há»£p vá»›i session lÃ m viá»‡c báº±ng API key Ä‘Æ°á»£c cung cáº¥p tá»« tÃ i khoáº£n Wandb.<br>
 ![image](https://github.com/user-attachments/assets/86d38870-3776-4510-a22b-7379df1f629f)<br>

VÃ¬ nhÃ³m lÃ m viá»‡c trÃªn ná»n táº£ng Kaggle, website cÃ³ sáºµn chá»©c nÄƒng Secrets gÃ¡n API key vá»›i má»™t tá»« khÃ³a (cá»¥ thá»ƒ trong hÃ¬nh lÃ  WANDB) Ä‘á»ƒ trÃ¡nh viá»‡c pháº£i paste cáº£ key vÃ o code, lÃ m lá»™ máº¥t key cho ngÆ°á»i khÃ¡c tháº¥y Ä‘Æ°á»£c.<br><br>
b.	Triá»ƒn khai<br>
Sau khi Ä‘Ã£ Ä‘Äƒng nháº­p vÃ o session huáº¥n luyá»‡n, ta cáº§n thá»±c hiá»‡n viá»‡c triá»ƒn khai tracking. Viá»‡c triá»ƒn khai yÃªu cáº§u pháº£i nháº­p vÃ o cÃ¡c thÃ´ng tin vá» lÆ°á»£t run nhÆ° lÃ  tÃªn dá»± Ã¡n, thÃ´ng sá»‘ mÃ´ hÃ¬nhâ€¦<br>
 ![image](https://github.com/user-attachments/assets/18518fec-810d-4801-835f-87037ba55eaa)<br>

c.	Log dá»¯ liá»‡u vÃ  káº¿t thÃºc<br>
Tiáº¿p theo, ta cáº§n pháº£i thÃªm cÃ¡c Ä‘oáº¡n code Ä‘á»ƒ lÆ°u láº¡i nhá»¯ng dá»¯ liá»‡u mong muá»‘n trong lÆ°á»£t run nÃ y.<br>
 ![image](https://github.com/user-attachments/assets/01059e1a-0dae-4245-89a7-0dcbedac2bac)
 ![image](https://github.com/user-attachments/assets/12839361-fedb-4454-bee8-7445ff537d02)
 ![image](https://github.com/user-attachments/assets/c3353598-ec36-41e9-9efc-7a7cdefc6abe)
 ![image](https://github.com/user-attachments/assets/49ecaad2-071c-4b25-84ef-c3c211f375dc)
 ![image](https://github.com/user-attachments/assets/7c80f034-b35a-4b10-9e7a-b074031159fc)
 ![image](https://github.com/user-attachments/assets/200c66b1-7a0c-44f5-ab81-ed1bf50d8010)<br>
 
NgoÃ i ra, Wandb cÃ²n cÃ³ cáº£ chá»©c nÄƒng save láº¡i checkpoint cá»§a model tá»‘t nháº¥t.<br>
 ![image](https://github.com/user-attachments/assets/11bfeed9-d42a-46ad-a16c-59a72c58eba1)<br>

Sau khi Ä‘Ã£ log láº¡i toÃ n bá»™ nhá»¯ng gÃ¬ cáº§n thiáº¿t, ta cáº§n pháº£i cÃ³ lá»‡nh dá»«ng tracking sau khi Ä‘Ã£ xong lÆ°á»£t run (quan trá»ng).<br>
 ![image](https://github.com/user-attachments/assets/bb29f216-35a3-4335-bcca-76301c982f5a)<br>

Náº¿u khÃ´ng cÃ³ lá»‡nh nÃ y, Wandb sáº½ váº«n tiáº¿p tá»¥c thá»±c hiá»‡n viá»‡c tracking cho dÃ¹ quÃ¡ trÃ¬nh huáº¥n luyá»‡n Ä‘Ã£ hoÃ n táº¥t, dáº«n Ä‘áº¿n viá»‡c tiÃªu hao tÃ i nguyÃªn vÃ  nguy cÆ¡ gáº·p lá»—i lÆ°u dá»¯ liá»‡u náº¿u tÃ¬m cÃ¡ch dá»«ng Ä‘á»™t ngá»™t.<br><br>
d.	Giao diá»‡n Wandb<br>
 ![image](https://github.com/user-attachments/assets/3d63ddba-5b56-4988-b5ea-687cb67f33a9)<br>
Giao diá»‡n overview cá»§a lÆ°á»£t run, Ä‘Ã¢y lÃ  nÆ¡i Ä‘á»ƒ xem thÃ´ng tin khÃ¡i quÃ¡t nhÆ° tÃªn dá»± Ã¡n, tham sá»‘, dataset, thá»i gian huáº¥n luyá»‡nâ€¦.<br>

 ![image](https://github.com/user-attachments/assets/0c8ec69c-5a6d-4ade-a23b-0209c96de876)<br>
Giao diá»‡n Workspace, Ä‘Ã¢y lÃ  nÆ¡i Ä‘á»ƒ kiá»ƒm tra láº¡i cÃ¡c dá»¯ liá»‡u Ä‘Æ°á»£c log<br>
 
 ![image](https://github.com/user-attachments/assets/1cfca0c0-6d33-464a-87df-f9911629fcda)<br>
Giao diá»‡n log, chá»©a log cá»§a Ä‘oáº¡n code trong quÃ¡ trÃ¬nh cháº¡y<br>

 ![image](https://github.com/user-attachments/assets/0a8a55ee-048e-4edf-aa9a-774776b34db8)<br>
Giao diá»‡n Files, lÃ  nÆ¡i chá»©a gá»‘c rá»… thÆ° má»¥c, cÃ³ thá»ƒ tÃ¬m tháº¥y dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c log á»Ÿ Ä‘Ã¢y dÆ°á»›i dáº¡ng file<br>

# HÆ¯á»šNG DáºªN MONITORING, ALERTING VÃ€ LOGGING
## ğŸ“ Chuáº©n bá»‹ thÆ° má»¥c
1.	Táº£i folder Deploy_api_and_Monitoring cÃ¹ng toÃ n bá»™ ná»™i dung bÃªn trong.
2.	Táº£i file grafana_dashboard_model.json vÃ  Ä‘áº·t vÃ o cÃ¹ng thÆ° má»¥c Deploy_api_and_Monitoring.

---

## ğŸ–¥ï¸ CÃ i Ä‘áº·t & cháº¡y trÃªn mÃ¡y local

### ğŸ”¹ TrÆ°á»ng há»£p 1: DÃ¹ng image cÃ³ sáºµn tá»« DockerHub *(Nhanh gá»n)*

KhÃ´ng cáº§n build láº¡i image, chá»‰ cáº§n cháº¡y:

```bash
docker compose up
```

ğŸ“ *Máº·c Ä‘á»‹nh `docker-compose.yml` Ä‘Ã£ sá»­ dá»¥ng image cÃ³ sáºµn tá»« DockerHub:*

```yaml
image: <your-dockerhub-username>/<your-image-name>
```

---

### ğŸ”¹ TrÆ°á»ng há»£p 2: Tá»± build image tá»« mÃ£ nguá»“n

1. Má»Ÿ file `docker-compose.yml`
2. TÃ¬m dÃ²ng:

```yaml
image: <your-dockerhub-username>/<your-image-name>
```

3. **XÃ³a dÃ²ng nÃ y** hoáº·c thay báº±ng tÃªn image tÃ¹y chá»n, vÃ­ dá»¥:

```yaml
image: my-fastapi-app:latest
```

4. Cháº¡y lá»‡nh sau Ä‘á»ƒ build vÃ  khá»Ÿi Ä‘á»™ng:

```bash
docker compose up --build
```

âš ï¸ *Náº¿u khÃ´ng chá»‰nh sá»­a `image:` thÃ¬ Docker sáº½ tiáº¿p tá»¥c dÃ¹ng image tá»« DockerHub.*

---

### ğŸ” Kiá»ƒm tra API

Má»Ÿ trÃ¬nh duyá»‡t truy cáº­p:  
ğŸ‘‰ [http://localhost:5050/docs](http://localhost:5050/docs)

ğŸ›‘ Äá»ƒ dá»«ng á»©ng dá»¥ng:  
Nháº¥n `Ctrl + C` trong terminal

---

## ğŸ“ˆ Truy cáº­p Grafana Ä‘á»ƒ xem Monitoring & Logging

1. Má»Ÿ trÃ¬nh duyá»‡t:
   - Local: [http://localhost:3000](http://localhost:3000)
   - Server: [http://<ip_server>:3000](http://<ip_server>:3000)

2. ÄÄƒng nháº­p:
   - **Username:** `admin`
   - **Password:** `admin` (sáº½ yÃªu cáº§u Ä‘á»•i máº­t kháº©u sau láº§n Ä‘Äƒng nháº­p Ä‘áº§u tiÃªn)

---

## âš™ï¸ Cáº¥u hÃ¬nh Grafana

1. **ThÃªm Data Source**
   - VÃ o `Connections` â†’ `Data Sources` â†’ `Add data source`
   - **Chá»n Prometheus:**
     - Name: `prometheus`
     - URL: `http://prometheus:9090`
     - Save & Test
   - **Chá»n Loki:**
     - Name: `loki`
     - URL: `http://loki:3000`
     - Save & Test

---

2. **ThÃªm Dashboards**

ğŸ”¹ **Dashboard 1:**

- VÃ o `Dashboards` â†’ `New` â†’ `Import`
- Nháº­p ID: `1860` â†’ Load â†’ Load

ğŸ“Š *Hiá»ƒn thá»‹: CPU usage, RAM usage, Disk space, disk IO, Network IO (Tx/Rx)*

ğŸ”¹ **Dashboard 2:**

- VÃ o `Dashboards` â†’ `New` â†’ `Import`
- Upload file: `grafana_dashboard_model.json` â†’ Load

ğŸ“Š *Hiá»ƒn thá»‹: Request per second, Error rate, Latency, Inference speed, Confidence score*

---

## ğŸ“œ Xem log vá»›i Loki

1. VÃ o má»™t dashboard â†’ `Add visualization`
2. Chá»n **Data source:** `loki`
3. Pháº§n `Queries` nháº­p má»™t trong cÃ¡c dÃ²ng sau Ä‘á»ƒ lá»c log:

```
# 1. App logs
{job="app_logfile"}

# 2. Docker stdout/stderr
{job="docker_stdout"}

# 3. Chá»‰ stdout
{job="docker_stdout", stream="stdout"}

# 4. Chá»‰ stderr
{job="docker_stdout", stream="stderr"}

# 5. Syslog
{job="syslog"}
```

CÃ³ thá»ƒ tÃ¹y chá»‰nh vÃ  lÆ°u láº¡i visualization theo nhu cáº§u.
